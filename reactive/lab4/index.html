<html>
<head>
<meta http-equiv="content-type" content="text/html; charset=utf-8">
<title>Scala</title>
<link rel="stylesheet" type="text/css" href="../style.css">
</head>
<body>
<table width="80%" height="90%" border="0" align="center">
<tr>
<td align="center">
<div align="left">

<hr>
    <h2>Programowanie reaktywne w języku Scala</h2>
<hr>

<h2>Zarządzanie stanem aktorów</h2>
    
    <h3>Utrwalanie i odtwarzanie stanu</h3>
<ul>
    <li>
        W celu utrwalania stanu aktora, używamy wzorca <tt>Event Sourcing</tt> zaimplementowanego w bibliotece <a href="http://doc.akka.io/docs/akka/current/scala/persistence.html"> Akka persistence</a>.
    </li>
    <li> Przykładowy projekt używający persystencji Akki
<pre>
git clone https://github.com/agh-reactive/reactive-lab4
</pre>
    </li>
    <li>Proszę sprawdzić zachowanie aktora <tt>PersistentBankAccount</tt> przy kilkukrotnym uruchomieniu projektu. Co się zmienia, gdy wyślemy do niego komunikat <tt>Snap</tt>?</li>
    <li>Projekt wykorzystuje wbudowaną bazę danych LevelDB do zapisu dziennika zdarzeń. Pliki bazy tworzone są w katalogu <tt>target/journal/.</tt> (dla eventów) oraz <tt> target/snapshot/. </tt> (dla snapshotów).</li>
    <li>Baza używa wbudowanej implementacji w Javie, co skonfigurowane jest w pliku <a href="https://github.com/agh-reactive/reactive-lab4/blob/master/src/main/resources/application.conf"><tt>src/main/resources/application.conf</tt></a>.</li>
    <li>Przykład użycia persystencji dla aktora wykorzystującego <tt>context.become()</tt> zamieszczony jest w pliku: <a href="https://github.com/agh-reactive/reactive-lab4/blob/master/src/main/scala/reactive4/persistence/PersistentToggle.scala">PersistentToggle.scala</a>.</li>
    <li>Przykład użycia persystencji dla aktora wykorzystującego <tt>FSM</tt> zamieszczony jest w pliku: <a href="https://github.com/agh-reactive/reactive-lab4/blob/master/src/main/scala/reactive4/fsm/PersistentToggleFSM.scala">PersistentToggleFSM.scala</a>. Uwaga: <a href="https://doc.akka.io/docs/akka/current/persistence-fsm.html#persistent-fsm">PersistentFSM</a> będzie wycofywany i zastępowany Akka Typed Persistence.
</ul>

<h3>Zadanie</h3>

    Do implementacji zadań proszę użyć szablonu: <a href="https://github.com/agh-reactive/reactive-scala-labs-templates/tree/lab-4">https://github.com/agh-reactive/reactive-scala-labs-templates/tree/lab-4</a>
    Jeśli ktoś budował Checkout i CartActor za pomocą FSM to może chcieć wykorzystać mechanizm persystencji <tt>PersistentFSM</tt>, ale ze względu na wycofywanie tej implementacji, szablon jej nie zawiera. 
    
<ol>
    <li>
        (15 pkt) Persystencja koszyka. Proszę zaimplementować persystencję stanu koszyka przy pomocy mechanizmu event sourcingu.
        Proszę zwrócić uwagę na poprawne odtwarzanie timerów.
    </li>
    <p></p>
    <li>
        (15 pkt) Proszę zaimplementować persystencję stanu aktora <tt>PersistentCheckout</tt> i przetestować scenariusz, w którym w trakcie
        operacji checkout-u aplikacja zostaje przerwana (np. poprzez <tt>system.terminate</tt>). Po ponownym uruchomieniu
        stan aplikacji powinien być poprawnie odtworzony (łącznie z timerami).
    </li>
    <p></p>
    <li>(10 pkt) Proszę napisać testy dla klasy <tt>PersistentCartActor</tt> (tak, aby oprócz standardowych operacji uwzględniały również odtwarzanie stanu aktora).</li>
    <!--
    <li>(10 pkt) Proszę porównać wydajność różnych mechanizmów persystencji (np. LevelDB z opcją native = true/false, 
        InMemory, itp., <a href="http://akka.io/community/">lista wtyczek</a>) i oszacować średni czas zapisu/odczytu zdarzenia.
    -->
</ol>
<!--
<h3>Bibliografia</h3>
<ol>
</ol>
!-->
    <p> </p>
    <p> </p>
<hr>
<i>Bartosz Baliś, balis at agh edu pl</i>
<br>
<i>Maciej Malawski, malawski at agh edu pl</i>
<br>
<i>Katarzyna Rycerz, kzajac at agh edu pl</i>
<br>
<p> </p>
</div>
</td>
</tr>
</table>
</body>
</html>
